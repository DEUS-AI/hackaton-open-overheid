FROM python:3.12-slim

# Install uv
RUN pip install uv

# Define working directory
WORKDIR /app

# Copy project files
COPY pyproject.toml uv.lock ./
COPY shared/ ./shared/

# Create a persistent project virtual environment with all runtime deps
RUN uv sync --frozen --no-dev

# Activate the virtual environment for all subsequent layers/containers
ENV VIRTUAL_ENV=/app/.venv
ENV PATH="$VIRTUAL_ENV/bin:$PATH"
ENV UV_NO_SYNC=1

# Configure environment variables
ENV PYTHONUNBUFFERED=1
